<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.recklessmo.dao.student.StudentDAO">
    <sql id = "baseInfoColumns">
        id, sid, name, phone, gender
    </sql>

    <sql id = "studentAddColumns">
        sid, name, other_name,phone, scn, gender, birth, home_town, people, birth_town, address, qq, wechat, grade_id, grade_name, class_id, class_name, job, wechat_id
    </sql>

    <sql id = "studentAllColumns">
        id, sid, name, other_name,phone, scn, gender, birth, home_town, people, birth_town, address, qq, wechat, grade_id, grade_name, class_id, class_name, job, wechat_id
    </sql>

    <insert id="insertStudentAddInfo" parameterType="com.recklessmo.model.student.StudentAddInfo">
        insert into student
        (
        <include refid="studentAddColumns"/>
        )
        VALUES (
        #{sid},#{name}, #{otherName}, #{phone}, #{scn}, #{gender}, #{birth}, #{homeTown}, #{people}, #{birthTown}, #{address}, #{qq}, #{wechat}, #{gradeId}, #{gradeName}, #{classId}, #{className}, #{job}, #{wechatId}
        )
    </insert>

    <insert id="insertStudentList" parameterType="com.recklessmo.model.student.StudentAddInfo">
        insert into student
        (
        <include refid="studentAddColumns"/>
        )
        VALUES
        <foreach collection="list" item="student" separator=",">
            (#{student.sid},#{student.name}, #{student.otherName},
            #{student.phone}, #{student.scn}, #{student.gender},
            #{student.birth}, #{student.homeTown}, #{student.people},
            #{student.birthTown}, #{student.address}, #{student.qq},
            #{student.wechat}, #{student.gradeId}, #{student.gradeName},
            #{student.classId}, #{student.className}, #{student.job}, #{student.wechatId})
        </foreach>
    </insert>

    <sql id="byPageQuery">

    </sql>

    <select id="getStudentBaseInfoList" resultType="com.recklessmo.model.student.StudentBaseInfo">
        select
        <include refid="baseInfoColumns"/>
        from student
        <include refid="byPageQuery"/>
        limit #{startIndex}, #{count}
    </select>

    <select id="getStudentBaseInfoListTotalCount" resultType="java.lang.Integer">
        select
        count(1)
        from student
        <include refid="byPageQuery"/>
    </select>

    <select id="getStudentAllInfo" resultType="com.recklessmo.model.student.StudentAllInfo">
        select
        <include refid="studentAllColumns"/>
        from student
        <include refid="byPageQuery"/>
        limit #{startIndex}, #{count}
    </select>

    <select id="getStudentAllInfoTotalCount" resultType="java.lang.Integer">
        select
        count(1)
        from student
        <include refid="byPageQuery"/>
    </select>
    
    <select id="getStudentAllInfoByWechatId" resultType="com.recklessmo.model.student.StudentAllInfo">
        select * from student
        where wechat_id = #{wechatId}
        limit 1
    </select>

    <select id="getStudentListByGradeIdAndClassId" resultType="com.recklessmo.model.student.StudentAllInfo">
        select * from student
        where gradeId = #{gradeId}
        <if test="classId != 0">
            and class_id = #{classId}
        </if>
    </select>

    <select id="getStudentGradeInfoBySidList" resultType="com.recklessmo.model.student.StudentGradeInfo">
        select id, sid, name, grade_id, class_id
        from student
        where sid in
        <foreach collection="sidList" item="sid" open="(" close=")" separator=",">
            #{sid}
        </foreach>
    </select>

    <select id="searchStudentByExam" resultType="com.recklessmo.model.student.StudentGradeInfo">
        select st.id, st.sid, st.name, st.grade_id, st.class_id
        from student st left join score sc on st.sid = sc.sid
        where sc.exam_id = #{examId}
    </select>

</mapper>